<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
<h:head>
    <title>Panel - Gerente General</title>
    <meta charset="UTF-8" />

    <f:metadata>
        <f:viewAction action="#{loginBean.verificarSesion}" />
    </f:metadata>

    <style>
        /* ... (Todos tus estilos CSS existentes van aquí) ... */
        body, html { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: #f0f2f5; }
        .wrapper { display: flex; min-height: 100vh; }
        h2 { color: #006B3F; border-bottom: 2px solid #f4f4f4; padding-bottom: 10px; }
        h3 { color: #333; }
        .header { background: #ffffff; color: #333; padding: 0 30px; display: flex; justify-content: space-between; align-items: center; height: 60px; border-bottom: 1px solid #ddd; width: 100%; position: fixed; top: 0; left: 0; z-index: 100; }
        .header .logo { font-size: 1.5em; font-weight: bold; color: #006B3F; }
        .header .user-info { display: flex; align-items: center; }
        .header .logout-btn { background: #1f4449; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; text-decoration: none; margin-left: 20px; }
        .sidebar { width: 220px; background: #ffffff; padding: 20px; padding-top: 80px; border-right: 1px solid #ddd; position: fixed; top: 0; left: 0; height: 100%; }
        .sidebar .nav-menu { list-style: none; padding: 0; margin: 0; }
        .sidebar .nav-menu li { margin-bottom: 10px; }
        .sidebar .nav-menu a { display: block; padding: 12px 15px; text-decoration: none; color: #333; font-weight: 500; border-radius: 8px; transition: background-color 0.2s; }
        .sidebar .nav-menu a:hover { background-color: #f0f2f5; }
        .sidebar .nav-menu a.active { background-color: #006B3F; color: white; }
        .main-content { margin-left: 260px; margin-top: 60px; padding: 30px; width: 100%; }
        .card { background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); padding: 25px; margin-bottom: 20px; }
        .tabla-sucursales { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .tabla-sucursales th, .tabla-sucursales td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .tabla-sucursales th { background-color: #f9f9f9; }
        .form-nueva-sucursal { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 20px; align-items: flex-end; }
        .form-group { margin-bottom: 15px; }
        .form-group label { font-weight: 500; display: block; margin-bottom: 5px; }
        input[type="text"], input[type="password"], input[type="date"], select, .btn-submit { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; box-sizing: border-box; }
        .btn-submit { background-color: #007A45; color: white; cursor: pointer; border: none; font-size: 15px; }
        .messages { margin-bottom: 20px; }
        .msg-info { color: green; font-weight: bold; }
        .msg-error { color: red; font-weight: bold; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .form-grid .full-width { grid-column: 1 / -1; }
        .error-field { color: #D8000C; font-size: 0.85em; display: block; margin-top: 4px;}
    </style>
</h:head>

<h:body>

    <div class="header">
        <div class="logo">Panel de Gerente General</div>
        <div class="user-info">
            <span>Bienvenido, <strong>#{loginBean.usuarioLogeado.username}</strong></span>
            <h:form>
                <h:commandLink value="Cerrar Sesión" action="#{loginBean.logout}" styleClass="logout-btn" />
            </h:form>
        </div>
    </div>
    <div class="wrapper">
        <div class="sidebar">
            <h:form id="navForm">
                <ul class="nav-menu">
                    <li>
                        <h:commandLink value="Gestión de Sucursales" action="#{gerenteGeneralBean.cambiarVista('sucursales')}"
                                       styleClass="#{gerenteGeneralBean.vistaActual == 'sucursales' ? 'active' : ''}">
                            <f:ajax execute="@this" render=":panelContenido :navForm" />
                        </h:commandLink>
                    </li>
                    <li>
                        <h:commandLink value="Acciones de Personal" action="#{gerenteGeneralBean.cambiarVista('personal')}"
                                       styleClass="#{gerenteGeneralBean.vistaActual == 'personal' ? 'active' : ''}">
                            <f:ajax execute="@this" render=":panelContenido :navForm" />
                        </h:commandLink>
                    </li>
                    <li>
                        <h:commandLink value="Ver Movimientos" action="#{gerenteGeneralBean.cambiarVista('movimientos')}"
                                       styleClass="#{gerenteGeneralBean.vistaActual == 'movimientos' ? 'active' : ''}">
                            <f:ajax execute="@this" render=":panelContenido :navForm" />
                        </h:commandLink>
                    </li>
                </ul>
            </h:form>
        </div>

        <div class="main-content">
            <h:panelGroup id="panelContenido" layout="block">

                <h:messages globalOnly="false" styleClass="messages"
                            infoClass="msg-info" errorClass="msg-error"/>

                <h:panelGroup rendered="#{gerenteGeneralBean.vistaActual == 'sucursales'}">

                    <div class="card">
                        <h2>Crear Nueva Sucursal</h2>
                        <h:form styleClass="form-nueva-sucursal">
                            <div class="form-group">
                                <label for="nombre">Nombre Sucursal:</label>
                                <h:inputText id="nombre" value="#{gerenteGeneralBean.nuevoNombre}" required="true" />
                            </div>
                            <div class="form-group">
                                <label for="direccion">Dirección:</label>
                                <h:inputText id="direccion" value="#{gerenteGeneralBean.nuevaDireccion}" required="true" />
                            </div>
                            <div class="form-group">
                                <label for="telefono">Teléfono:</label>
                                <h:inputText id="telefono" value="#{gerenteGeneralBean.nuevoTelefono}" required="true" />
                            </div>
                            <div class="form-group">
                                <h:commandButton value="Crear Sucursal"
                                                 action="#{gerenteGeneralBean.crearSucursal}"
                                                 styleClass="btn-submit">
                                    <f:ajax execute="@form" render=":panelContenido" />
                                </h:commandButton>
                            </div>
                        </h:form>
                    </div>

                    <div class="card">
                        <h2>Gerentes Asignados y Sucursales</h2>
                        <h:dataTable value="#{gerenteGeneralBean.listaGerentesSucursal}" var="emp"
                                     styleClass="tabla-sucursales" rendered="#{not empty gerenteGeneralBean.listaGerentesSucursal}">

                            <h:column>
                                <f:facet name="header">Sucursal</f:facet>
                                #{emp.sucursal.nombre}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Gerente Asignado</f:facet>
                                #{emp.persona.nombres} #{emp.persona.apellidos}
                            </h:column>

                            <h:column>
                                <f:facet name="header">DUI Gerente</f:facet>
                                #{emp.persona.dui}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Salario</f:facet>
                                <h:outputText value="#{emp.salario}">
                                    <f:convertNumber type="currency" currencySymbol="$" />
                                </h:outputText>
                            </h:column>

                            <h:column>
                                <f:facet name="header">Estado Empleado</f:facet>
                                #{emp.estado}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Fecha Contratación</f:facet>
                                <h:outputText value="#{emp.fechaContratacion}"><f:convertDateTime pattern="dd/MM/yyyy" /></h:outputText>
                            </h:column>
                        </h:dataTable>
                        <h:outputText value="No hay Gerentes de Sucursal asignados."
                                      rendered="#{empty gerenteGeneralBean.listaGerentesSucursal}" />
                    </div>
                    <div class="card">
                        <h2>Crear y Asignar Nuevo Gerente de Sucursal</h2>
                        <h:form id="formGerenteSucursal">
                            <div class="form-grid">
                                <div class="form-group full-width">
                                    <label for="sucursal">Asignar a Sucursal:</label>
                                    <h:selectOneMenu id="sucursal" value="#{gerenteGeneralBean.sucursalAsignadaId}" required="true"
                                                     requiredMessage="Debe seleccionar una sucursal.">
                                        <f:selectItem itemValue="" itemLabel="-- Seleccione una --" noSelectionOption="true" />
                                        <f:selectItems value="#{gerenteGeneralBean.listaSucursales}" var="s"
                                                       itemValue="#{s.idSucursal}" itemLabel="#{s.nombre}" />
                                    </h:selectOneMenu>
                                    <h:message for="sucursal" styleClass="error-field"/>
                                </div>
                                <div class="form-group">
                                    <label for="salario">Salario (USD):</label>
                                    <h:inputText id="salario" value="#{gerenteGeneralBean.gerenteSalario}" required="true"
                                                 requiredMessage="El salario es obligatorio.">
                                        <f:convertNumber minFractionDigits="2" />
                                    </h:inputText>
                                    <h:message for="salario" styleClass="error-field"/>
                                </div>
                                <div class="form-group">
                                    <label for="dui">DUI:</label>
                                    <h:inputText id="dui" value="#{gerenteGeneralBean.gerenteDui}" required="true"
                                                 requiredMessage="El DUI es obligatorio."
                                                 validatorMessage="El DUI debe contener 9 dígitos (sin guion)">
                                        <f:validateRegex pattern="^[0-9]{9}$" />
                                    </h:inputText>
                                    <h:message for="dui" styleClass="error-field"/>
                                </div>
                                <div class="form-group">
                                    <label for="nombres">Nombres:</label>
                                    <h:inputText id="nombres" value="#{gerenteGeneralBean.gerenteNombres}" required="true" requiredMessage="El nombre es obligatorio." />
                                    <h:message for="nombres" styleClass="error-field"/>
                                </div>
                                <div class="form-group">
                                    <label for="apellidos">Apellidos:</label>
                                    <h:inputText id="apellidos" value="#{gerenteGeneralBean.gerenteApellidos}" required="true" requiredMessage="El apellido es obligatorio."/>
                                    <h:message for="apellidos" styleClass="error-field"/>
                                </div>
                                <div class="form-group">
                                    <label for="fechaNac">Fecha de Nacimiento:</label>
                                    <h:inputText id="fechaNac" value="#{gerenteGeneralBean.gerenteFechaNac}" required="true" requiredMessage="La fecha es obligatoria." a:type="date">
                                        <f:convertDateTime pattern="yyyy-MM-dd" />
                                    </h:inputText>
                                    <h:message for="fechaNac" styleClass="error-field"/>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email:</label>
                                    <h:inputText id="email" value="#{gerenteGeneralBean.gerenteEmail}" required="true" requiredMessage="El email es obligatorio."
                                                 validatorMessage="Email no válido">
                                        <f:validateRegex pattern="^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$" />
                                    </h:inputText>
                                    <h:message for="email" styleClass="error-field"/>
                                </div>
                                <div class="form-group">
                                    <label for="telefono">Teléfono:</label>
                                    <h:inputText id="telefono" value="#{gerenteGeneralBean.gerenteTelefono}" required="true" requiredMessage="El teléfono es obligatorio."/>
                                    <h:message for="telefono" styleClass="error-field"/>
                                </div>
                                <div class="form-group">
                                    <label for="username">Nombre de Usuario (Login):</label>
                                    <h:inputText id="username" value="#{gerenteGeneralBean.gerenteUsername}" required="true" requiredMessage="El username es obligatorio."/>
                                    <h:message for="username" styleClass="error-field"/>
                                </div>
                                <div class="form-group">
                                    <label for="password">Contraseña (Login):</label>
                                    <h:inputSecret id="password" value="#{gerenteGeneralBean.gerentePassword}" required="true" requiredMessage="La clave es obligatoria."/>
                                    <h:message for="password" styleClass="error-field"/>
                                </div>
                                <div class="form-group full-width">
                                    <h:commandButton value="Crear y Asignar Gerente"
                                                     action="#{gerenteGeneralBean.crearYAsignarGerente}"
                                                     styleClass="btn-submit" style="margin-top: 15px;">
                                        <f:ajax execute="@form" render=":panelContenido" />
                                    </h:commandButton>
                                </div>
                            </div>
                        </h:form>
                    </div>
                </h:panelGroup>

                <h:panelGroup rendered="#{gerenteGeneralBean.vistaActual == 'personal'}">
                    <h2>Gestión de Acciones de Personal</h2>
                    <p>Esta sección está en construcción.</p>
                </h:panelGroup>
                <h:panelGroup rendered="#{gerenteGeneralBean.vistaActual == 'movimientos'}">
                    <h2>Visor de Movimientos Globales</h2>
                    <p>Esta sección está en construcción.</p>
                </h:panelGroup>

            </h:panelGroup>
        </div>

    </div>
</h:body>
</html>